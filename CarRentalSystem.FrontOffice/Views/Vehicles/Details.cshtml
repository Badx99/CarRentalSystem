@using CarRentalSystem.FrontOffice.Models.ViewModels
@model VehicleDetailViewModel
@{
    ViewData["Title"] = $"{Model.Vehicle.Brand} {Model.Vehicle.Model} - Details";
}

<div class="row">
    <!-- Image Gallery -->
    <div class="col-md-8 mb-4">
        <div class="card shadow-sm">
            <img src="@(Model.Vehicle.ImageUrl ?? "https://via.placeholder.com/800x450?text=Car+Image")" class="card-img-top" alt="@Model.Vehicle.Brand">
        </div>
        
        <div class="card mt-4 shadow-sm">
            <div class="card-header bg-light">
                <h4 class="mb-0">Vehicle Description</h4>
            </div>
            <div class="card-body">
                
                <p>Perfect for your travel needs, this @Model.Vehicle.Year model offers style, comfort, and reliability.</p>
            </div>
        </div>
    </div>

    <!-- Specs and Booking -->
    <div class="col-md-4">
        <!-- Key Details -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h2 class="card-title mb-1">@Model.Vehicle.Brand @Model.Vehicle.Model</h2>
                <p class="text-muted mb-3">@Model.Vehicle.Year â€¢ @Model.Vehicle.VehicleTypeName</p>
                
                <h3 class="text-primary mb-4">$@Model.Vehicle.DailyRate <small class="text-muted fs-6">/ day</small></h3>
                
                <ul class="list-group list-group-flush mb-4">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-palette"></i> Color</span>
                        <span class="fw-bold">@Model.Vehicle.Color</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-people"></i> Seats</span>
                        <span class="fw-bold">@Model.Vehicle.PassengerCapacity</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-speedometer2"></i> Mileage</span>
                        <span class="fw-bold">@Model.Vehicle.Mileage km</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-card-text"></i> License</span>
                        <span class="fw-bold">@Model.Vehicle.LicensePlate</span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Check Availability / Book -->
        <div class="card shadow-sm border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="bi bi-calendar-check"></i> Check Availability</h5>
            </div>
            <div class="card-body">
                <form id="checkAvailabilityForm">
                    <input type="hidden" id="vehicleId" value="@Model.Vehicle.Id" />
                    <div class="mb-3">
                        <label class="form-label">Pick-up Date</label>
                        <input type="date" id="startDate" class="form-control" value="@(Model.StartDate?.ToString("yyyy-MM-dd") ?? DateTime.Today.ToString("yyyy-MM-dd"))" min="@DateTime.Today.ToString("yyyy-MM-dd")">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Return Date</label>
                        <input type="date" id="endDate" class="form-control" value="@(Model.EndDate?.ToString("yyyy-MM-dd") ?? DateTime.Today.AddDays(1).ToString("yyyy-MM-dd"))" min="@DateTime.Today.ToString("yyyy-MM-dd")">
                    </div>
                    
                    <button type="button" class="btn btn-outline-primary w-100" onclick="checkAvailability()">Check Price & Availability</button>
                    
                    <div id="availabilityResult" class="mt-3 d-none">
                        <hr />
                        <div class="d-flex justify-content-between mb-2">
                             <span>Rental Duration:</span>
                             <span class="fw-bold" id="resultDays">0 days</span>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                             <span>Total Price:</span>
                             <span class="fw-bold text-success fs-5" id="resultPrice">$0.00</span>
                        </div>
                        <a id="bookButton" href="#" class="btn btn-success w-100 btn-lg">Book Now</a>
                    </div>
                    
                    <div id="availabilityError" class="alert alert-danger mt-3 d-none">
                        Selected dates are not available.
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function checkAvailability() {
            var vehicleId = document.getElementById('vehicleId').value;
            var startDate = document.getElementById('startDate').value;
            var endDate = document.getElementById('endDate').value;
            
            // Basic validation
            if(!startDate || !endDate) {
                alert('Please select both dates');
                return;
            }
            
            if(startDate >= endDate) {
                alert('Return date must be after pick-up date');
                return;
            }

            // AJAX call
            $.post('/Vehicles/CheckAvailability', { vehicleId: vehicleId, startDate: startDate, endDate: endDate })
                .done(function(response) {
                    if(response.available) {
                        $('#availabilityError').addClass('d-none');
                        $('#resultDays').text(response.days + ' days');
                        $('#resultPrice').text('$' + response.totalPrice.toFixed(2));
                        
                        // Update booking link
                        var bookUrl = '@Url.Action("Book", "Reservations")' + 
                                     '?vehicleId=' + vehicleId + 
                                     '&startDate=' + startDate + 
                                     '&endDate=' + endDate;
                        $('#bookButton').attr('href', bookUrl);
                        
                        $('#availabilityResult').removeClass('d-none');
                    } else {
                        $('#availabilityResult').addClass('d-none');
                        $('#availabilityError').removeClass('d-none').text(response.message || 'Vehicle not available');
                    }
                })
                .fail(function() {
                    alert('Error checking availability');
                });
        }
    </script>
}
