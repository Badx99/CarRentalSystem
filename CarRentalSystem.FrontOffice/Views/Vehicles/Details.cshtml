@using CarRentalSystem.FrontOffice.Helpers
@model CarRentalSystem.FrontOffice.Models.ViewModels.VehicleDetailViewModel
@{
    ViewData["Title"] = $"{Model.Vehicle.Brand} {Model.Vehicle.Model}";
}

<div class="container py-5">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index" class="text-purple">Home</a></li>
            <li class="breadcrumb-item"><a asp-controller="Vehicles" asp-action="Catalog" class="text-purple">Vehicles</a></li>
            <li class="breadcrumb-item active" aria-current="page">@Model.Vehicle.Brand @Model.Vehicle.Model</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-7 mb-4">
            <div class="card border-0 shadow-sm overflow-hidden rounded-4">
                <img src="@(string.IsNullOrEmpty(Model.Vehicle.ImageUrl) ? "/images/placeholder-car.jpg" : Model.Vehicle.ImageUrl)" 
                     class="img-fluid" 
                     alt="@Model.Vehicle.Brand @Model.Vehicle.Model"
                     onerror="this.src='/images/placeholder-car.jpg'"
                     style="width: 100%; height: 500px; object-fit: cover;">
            </div>
            
            <div class="card border-0 shadow-sm mt-4 rounded-4">
                <div class="card-body p-4">
                    <h4 class="fw-bold mb-4">Vehicle Description</h4>
                    <p class="text-muted fs-5">
                        Experience pure luxury and performance with the @Model.Vehicle.Year @Model.Vehicle.Brand @Model.Vehicle.Model. 
                        This @Model.Vehicle.VehicleTypeName is meticulously maintained to ensure the highest standards of safety and comfort.
                    </p>
                    <div class="row g-3 mt-2">
                        <div class="col-6 col-md-4">
                            <div class="d-flex align-items-center p-3 bg-light rounded-3">
                                <i class="fas fa-snowflake text-purple me-3 fa-lg"></i>
                                <div>
                                    <small class="text-muted d-block">A/C</small>
                                    <span class="fw-bold">Air Conditioning</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-4">
                            <div class="d-flex align-items-center p-3 bg-light rounded-3">
                                <i class="fas fa-gas-pump text-purple me-3 fa-lg"></i>
                                <div>
                                    <small class="text-muted d-block">Fuel</small>
                                    <span class="fw-bold">Premium Petrol</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-md-4">
                            <div class="d-flex align-items-center p-3 bg-light rounded-3">
                                <i class="fas fa-bluetooth text-purple me-3 fa-lg"></i>
                                <div>
                                    <small class="text-muted d-block">Audio</small>
                                    <span class="fw-bold">Bluetooth & Aux</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-5">
            <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <span class="badge bg-purple mb-2">@Model.Vehicle.VehicleTypeName</span>
                            <h1 class="fw-bold display-6">@Model.Vehicle.Brand @Model.Vehicle.Model</h1>
                            <p class="text-muted">@Model.Vehicle.Year â€¢ @Model.Vehicle.Color</p>
                        </div>
                        <div class="text-end">
                            <h2 class="text-purple fw-bold mb-0">$@Model.Vehicle.EffectiveDailyRate.ToString("N0")</h2>
                            <small class="text-muted">per day</small>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="row g-4 mb-4">
                        <div class="col-6">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-users text-purple me-3"></i>
                                <div>
                                    <small class="text-muted d-block">Capacity</small>
                                    <strong>@Model.Vehicle.PassengerCapacity Seats</strong>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-tachometer-alt text-purple me-3"></i>
                                <div>
                                    <small class="text-muted d-block">Mileage</small>
                                    <strong>@Model.Vehicle.Mileage.ToString("N0") km</strong>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-id-card text-purple me-3"></i>
                                <div>
                                    <small class="text-muted d-block">License</small>
                                    <strong>@Model.Vehicle.LicensePlate</strong>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-check-circle text-purple me-3"></i>
                                <div>
                                    <small class="text-muted d-block">Status</small>
                                    <strong class="@(Model.Vehicle.Status == "Available" ? "text-success" : "text-danger")">@Model.Vehicle.Status</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    @if (Context.IsAuthenticated())
                    {
                        <div class="bg-light p-4 rounded-4 border">
                            <h5 class="fw-bold mb-3"><i class="fas fa-calendar-alt text-purple me-2"></i>Book This Vehicle</h5>
                            
                            @if (Model.Vehicle.Status != "Available")
                            {
                                <div class="alert alert-warning border-0 small py-2">
                                    <i class="fas fa-info-circle me-2"></i>This vehicle is currently @Model.Vehicle.Status.ToLower().
                                </div>
                                <button class="btn btn-secondary w-100 btn-lg shadow-sm" disabled>Not Available</button>
                            }
                            else
                            {
                                <form asp-controller="Reservations" asp-action="Book" method="get">
                                    <input type="hidden" name="vehicleId" value="@Model.Vehicle.Id">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label small fw-bold">Pick-up Date</label>
                                            <input type="date" name="startDate" class="form-control" 
                                                   value="@(Model.StartDate?.ToString("yyyy-MM-dd") ?? DateTime.Today.AddDays(1).ToString("yyyy-MM-dd"))" 
                                                   min="@DateTime.Today.ToString("yyyy-MM-dd")" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label small fw-bold">Return Date</label>
                                            <input type="date" name="endDate" class="form-control" 
                                                   value="@(Model.EndDate?.ToString("yyyy-MM-dd") ?? DateTime.Today.AddDays(2).ToString("yyyy-MM-dd"))" 
                                                   min="@DateTime.Today.AddDays(1).ToString("yyyy-MM-dd")" required>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-purple w-100 btn-lg shadow-purple mt-4">
                                        <i class="fas fa-calendar-check me-2"></i>Continue to Booking
                                    </button>
                                </form>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info border-0 rounded-4 p-4 text-center">
                            <i class="fas fa-lock fa-2x mb-3 text-purple opacity-50"></i>
                            <h5 class="fw-bold mb-2">Login Required</h5>
                            <p class="small text-muted mb-4">Please log in to your account to book this premium vehicle.</p>
                            <a asp-controller="Auth" asp-action="Login" asp-route-returnUrl="@Url.Action("Details", "Vehicles", new { id = Model.Vehicle.Id })" class="btn btn-purple w-100 shadow-sm">Login to Book</a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
